{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "https://signalk.org/specification/1.0.0/schemas/groups/electrical.json#",
  "description": "Schema describing the electrical child-object of a Vessel.",
  "title": "Electrical Properties",
  "type": "object",
  "properties": { 
    "batteries": {
      "description": "Data about the vessel's batteries",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "Battery keyed by instance id",
          "description": "Batteries, one or many, within the vessel",
          "allOf": [{
              "$ref": "../definitions.json#/definitions/identity"
               },{
              "$ref": "../definitions.json#/definitions/dcQualities"
              }],
           "properties": { 
            "chemistry": {
              "type": "string",
              "description": "Type of battery FLA, LiFePO4, etc."
            },
            "temperature": {
              "type": "object",
              "title": "temperature",
              "description": "Additional / unique temperatures associated with a battery",
              "properties": {
                "limitDischargeLower": {
                  "type": "number",
                  "description": "Operational minimum temperature limit for battery discharge",
                  "units": "K"
                },

                "limitDischargeUpper": {
                  "type": "number",
                  "description": "Operational maximum temperature limit for battery discharge",
                  "units": "K"
                },

                "limitRechargeLower": {
                  "type": "number",
                  "description": "Operational minimum temperature limit for battery recharging",
                  "units": "K"
                },

                "limitRechargeUpper": {
                  "type": "number",
                  "description": "Operational maximum temperature limit for battery recharging",
                  "units": "K"
                }
              }
            },

            "capacity": {
              "type": "object",
              "description": "Data about the battery's capacity",
              "title": "capacity",
              "properties": {
                "nominal": {
                  "type": "number",
                  "description": "The capacity of battery as specified by the manufacturer",
                  "units": "J"
                },

                "actual": {
                  "type": "number",
                  "description": "The measured capacity of battery. This may change over time and will likely deviate from the nominal capacity.",
                  "units": "J"
                },

                "remaining": {
                  "type": "number",
                  "description": "Capacity remaining in battery",
                  "units": "J"
                },

                "dischargeLimit": {
                  "type": "number",
                  "description": "Minimum capacity to be left in the battery while discharging",
                  "units": "J"
                },

                "stateOfCharge": {
                  "$ref": "../definitions.json#/definitions/numberValue",
                  "description": "State of charge, 1 = 100%",
                  "units": "ratio"
                },

                "stateOfHealth": {
                  "$ref": "../definitions.json#/definitions/numberValue",
                  "description": "State of Health, 1 = 100%",
                  "units": "ratio"
                },

                "dischargeSinceFull": {
                  "$ref": "../definitions.json#/definitions/numberValue",
                  "description": "Cumulative discharge since battery was last full",
                  "units": "C"
                },

                "timeRemaining": {
                  "$ref": "../definitions.json#/definitions/numberValue",
                  "description": "Time to discharge to discharge limit at current rate",
                  "units": "s"
                }
              }
            },


            "lifetimeDischarge": {
              "type": "number",
              "description": "Cumulative charge discharged from battery over operational lifetime of battery",
              "units": "C"
            },

            "lifetimeRecharge": {
                "type": "number",
                "description": "Cumulative charge recharged into battery over operational lifetime of battery",
                "units": "C"
            }
          }
        }
      }  
     },
    "inverters": {
      "description": "Data about the Inverter that has both DC and AC qualities",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "Inverter",
          "description": "DC to AC inverter, one or many, within the vessel",
          "allOf": [{
            "$ref": "../definitions.json#/definitions/identity"
            }],   
          "properties": {   
            "dc": {
              "$ref": "../definitions.json#/definitions/dcQualities"
            },
            "ac": {
              "$ref": "../definitions.json#/definitions/acQualities"
            },
            "inverterMode": {
              "type": "object",
              "description": "Mode of inverter",
              "allOf": [
                {
                  "$ref": "../definitions.json#/definitions/commonValueFields"
                },
                {
                "properties": {
                  "value": {
                    "type": "string",
                    "enum": [
                      "idle",
                      "inverting",
                      "disabled",
                      "standby",
                      "faulted",
                      "unknown",
                      "other"
                      ]
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },    
    "chargers": {
      "description": "Data about AC sourced battery charger",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "Charger",
          "description": "Battery charger",
          "allOf": [{
            "$ref": "../definitions.json#/definitions/identity"
          },{
            "$ref": "../definitions.json#/definitions/dcQualities"
          },{
            "$ref": "../definitions.json#/definitions/chargerQualities"
          }]
        }
      }
    },
    "alternators": {
      "description": "Data about an Alternator charging device",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "Alternator",
          "description": "Mechanically driven alternator, includes dynamos",
            "allOf": [{
              "$ref": "../definitions.json#/definitions/identity"
              },{
                "$ref": "../definitions.json#/definitions/dcQualities"
              },{
                "$ref": "../definitions.json#/definitions/chargerQualities"
              }],
            "properties": {  
              "revolutions": {
                "description": "Alternator revolutions per second (x60 for RPM)",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "Hz"
              },
              "pulleyRatio": {
                "description": "Mechanical pulley ratio of driving source (Used to back calculate engine RPMs)",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "ratio"
              },
              "fieldDrive": {
                "description": "% (0..100) of field voltage applied",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "%"
              },
              "regulatorTemperature": {
                "description": "Current temperature of critical regulator components",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "K"
              }
            }
         }
      }
    },
    "solar": {
      "description": "Data about Solar charging device(s)",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "Solar",
          "description": "Photovoltaic charging devices",
          "allOf": [{
            "$ref": "../definitions.json#/definitions/identity"
          },{
            "$ref": "../definitions.json#/definitions/dcQualities"
          },{
            "$ref": "../definitions.json#/definitions/chargerQualities"
          }],
          "properties": { 
            "controllerMode": {
              "type": "object",
              "description": "The current state of the engine",
              "allOf": [
                {
                  "$ref": "../definitions.json#/definitions/commonValueFields"
                },
                {
                  "properties": {
                    "value": {
                      "type": "string",
                      "enum": [
                         "off",
                         "idle",
                         "direct",
                         "PWM",
                         "MPPT"
                      ]
                    }
                  }
                }
              ]
            },
            "panelVoltage": {
                "description": "Voltage being supplied from Solar Panels to controller",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "V"
            },
            "panelCurrent": {
                "description": "Amperage being supplied from Solar Panels to controller",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "A"
            },
            "panelTemperature": {
                "description": "Temperature of panels",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "K"
            },

            "load": {
              "type": "object",
              "description": "State of load port on controller (if applicable)",
              "allOf": [
                {
                  "$ref": "../definitions.json#/definitions/commonValueFields"
                },
                {
                  "properties": {
                    "value": {
                      "type": "string",
                      "enum": [
                        "enabled",
                        "disabled"
                      ]
                    }
                  }
                }
              ]
            },        
            "loadCurrent": {
                "description": "Amperage being supplied to load directly connected to controller",
                "$ref": "../definitions.json#/definitions/numberValue",
                "units": "A"
            }
          }
        }
      }
    },
    "ac": {
      "description": "AC buses",
      "patternProperties": {
        "(^[A-Za-z0-9]+$)": {
          "type": "object",
          "title": "AC Bus keyed by instance id",
          "description": "AC Bus, one or many, within the vessel",
          "allOf": [{
            "$ref": "../definitions.json#/definitions/identity"
          }],
          "properties": {
            "phase": {
              "type": "object",
              "description": "Single or A,B or C in 3 Phase systems ",
              "patternProperties": {
                "(single)|([A-C])": {
                  "$ref": "../definitions.json#/definitions/acQualities"
                }
              }
            }
          }
        }
      }
    }
  }
}

