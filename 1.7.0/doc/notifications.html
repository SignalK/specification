<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Notifications</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Signal K Specification</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Getting Started</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="start_using.html"><strong aria-hidden="true">2.1.</strong> Using SK</a></li><li class="chapter-item expanded "><a href="start_developing.html"><strong aria-hidden="true">2.2.</strong> Developing with SK</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Data Model</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="data_model.html"><strong aria-hidden="true">3.1.</strong> Full and Delta Models</a></li><li class="chapter-item expanded "><a href="data_model_multiple_values.html"><strong aria-hidden="true">3.2.</strong> Multiple Values</a></li><li class="chapter-item expanded "><a href="data_model_metadata.html"><strong aria-hidden="true">3.3.</strong> Metadata</a></li><li class="chapter-item expanded "><a href="sources.html"><strong aria-hidden="true">3.4.</strong> Sources</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> API</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="urls_ports.html"><strong aria-hidden="true">4.1.</strong> URLs and Ports</a></li><li class="chapter-item expanded "><a href="rest_api.html"><strong aria-hidden="true">4.2.</strong> REST API</a></li><li class="chapter-item expanded "><a href="streaming_api.html"><strong aria-hidden="true">4.3.</strong> Streaming API</a></li><li class="chapter-item expanded "><a href="subscription_protocol.html"><strong aria-hidden="true">4.4.</strong> Subscription Protocol</a></li><li class="chapter-item expanded "><a href="connection.html"><strong aria-hidden="true">4.5.</strong> Discovery &amp; Connection Establishment</a></li><li class="chapter-item expanded "><a href="notifications.html" class="active"><strong aria-hidden="true">4.6.</strong> Notifications</a></li><li class="chapter-item expanded "><a href="security.html"><strong aria-hidden="true">4.7.</strong> Security</a></li><li class="chapter-item expanded "><a href="request_response.html"><strong aria-hidden="true">4.8.</strong> Request/Response</a></li><li class="chapter-item expanded "><a href="put.html"><strong aria-hidden="true">4.9.</strong> PUT Requests</a></li></ol></li><li class="chapter-item expanded "><a href="how_to_help.html"><strong aria-hidden="true">5.</strong> How Can I Help?</a></li><li class="chapter-item expanded "><a href="vesselsBranch.html"><strong aria-hidden="true">6.</strong> Appendix A: Keys Reference (Vessel)</a></li><li class="chapter-item expanded "><a href="otherBranches.html"><strong aria-hidden="true">7.</strong> Appendix B: Keys Reference (Others)</a></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">8.</strong> Appendix C: Changelog</a></li><li class="chapter-item expanded "><a href="versioning.html"><strong aria-hidden="true">9.</strong> Appendix D: Versioning</a></li><li class="chapter-item expanded "><a href="access_requests.html"><strong aria-hidden="true">10.</strong> Appendix E: Access Requests</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="alarm-alert-and-notification-handling"><a class="header" href="#alarm-alert-and-notification-handling">Alarm, Alert, and Notification Handling</a></h1>
<p>Handling alarms, alerts, and notifications in Signal K is a multi-stage process. Alarms, alerts and notifications are
all handled the same way, and are all referred to as alarms below.</p>
<p>We need a flexible model to define alarm conditions, and a standard way to announce and record them.</p>
<h2 id="alarm-process"><a class="header" href="#alarm-process">Alarm Process</a></h2>
<ul>
<li>Define alarm states as zones in the meta object attached to any Signal K value. See [[Metadata for Data Values]]</li>
<li>If the value is within an alarm zone raise the defined alarm.</li>
<li>If the value goes out of the zone, remove the alarm by setting its value to null</li>
<li>Alarms are raised by placing an alarm object in the <code>vessels.self.notifications</code> tree</li>
</ul>
<h2 id="expected-implementation-behaviour"><a class="header" href="#expected-implementation-behaviour">Expected implementation behaviour</a></h2>
<ul>
<li>The server (or device) should monitor the current value and compare it to the defined zones.</li>
<li>If a value enters an alarm zone, then a key is written to <code>vessels.self.notifications..</code></li>
<li>If a value leaves an alarm zone, then the key is removed from <code>vessels.self.notifications..</code></li>
<li>Alarms raised are monitored by an alarm process on the server, which takes appropriate action, sounding alarms, or
displaying messages.</li>
<li>Clients interested in alarms can subcribe to the <code>vessels.self.notifications...</code> tree in the usual way and be informed
of alarms in the same way as normal signalk keys.</li>
<li>When an alarms is removed, a delta should be sent to subscribers with the path and a null value.</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>eg If we exceed our anchor alarm radius: <code>vessels.self.navigation.anchor.currentRadius</code> enters
<code>vessels.self.navigation.anchor.currentRadius.meta.zones : [ {lower: &quot;0&quot;, upper: maxRadius, state : &quot;normal&quot;}, {lower: maxRadius, upper: 999999, state: &quot;alarm&quot;}]</code></p>
<p>The alarm is : <code>vessels.self.notifications.navigation.anchor.currentRadius</code></p>
<p>The alarm object is</p>
<pre><code>{
  &quot;value&quot;: {
    &quot;method&quot;: [&quot;sound&quot;],
    &quot;state&quot;: &quot;alarm&quot;,
    &quot;message&quot;: &quot;Dragging anchor!&quot;
  },
  &quot;timestamp&quot;: &quot;...&quot;,
  &quot;$source&quot;: &quot;...&quot;
}
</code></pre>
<p>The server alarm manager will see this new entry and turn on the alarm. Using a manager process allows flexibility in
situations where multiple alarms are triggered and your vessel is a mass of flashing and beeping. eg A single 'Pause'
button can give you 5-10 minutes to take action, stopping annoying noise, and removing popup messages from screens.</p>
<p>Since the <code>vessels.self.notifications</code> tree mirrors the other data in the signal k model, we can selectively watch or
react to specific branches or keys. When displaying multiple alarms a screen can also sort and filter them.</p>
<h2 id="other-alarms"><a class="header" href="#other-alarms">Other Alarms</a></h2>
<p>Above we have discussed monitoring existing values and raising alarms. There are other alarms that must be considered,
eg MOB, fire, sinking etc, and misc alerts &quot;GPS signal lost&quot;.etc.</p>
<p>The <code>vessels.[uuid].notifications</code> tree is the same as any other Signal k branch. Keys can be added and removed as
required in the usual way. Since the branch is being monitored we only need to add a key of any sort to create a
suitable alarm.</p>
<p>In the case of an emergency, create a unique key: The alarm is : <code>vessels.[uuid].notifications.[alarm.key]</code></p>
<p>The alarm object is</p>
<pre><code>{
  &quot;value&quot;: {
    &quot;method&quot;: [&quot;visual&quot;, &quot;sound&quot;],
    &quot;state&quot;: &quot;emergency&quot;,
    &quot;message&quot;: &quot;Man Overboard!&quot;
  },
  ...
}
</code></pre>
<p>Alarm objects that have been raised this way must be cleared manually, or by the process that created them. You can use
any suitable path, keeping in mind the context of the alarm.</p>
<p>eg In the case of an alert, create a unique key by generating a path: The alarm is :
<code>vessels.[uuid].notifications.navigation.gnss</code></p>
<p>The alarm object is</p>
<pre><code>{
  &quot;value&quot;: {
    &quot;method&quot;: [&quot;visual&quot;],
    &quot;state&quot;: &quot;alert&quot;,
    &quot;message&quot;: &quot;GPS signal lost!&quot;
  },
  ...
}
</code></pre>
<h3 id="well-known-names"><a class="header" href="#well-known-names">Well Known Names</a></h3>
<p>Some alarms are especially important, eg MOB. This is a list of keys for special alarms.</p>
<ul>
<li><code>..notifications.mob.*</code></li>
<li><code>..notifications.fire.*</code></li>
<li><code>..notifications.sinking.*</code></li>
<li><code>..notifications.flooding.*</code></li>
<li><code>..notifications.collision.*</code></li>
<li><code>..notifications.grounding.*</code></li>
<li><code>..notifications.listing.*</code></li>
<li><code>..notifications.adrift.*</code></li>
<li><code>..notifications.piracy.*</code></li>
<li><code>..notifications.abandon.*</code></li>
</ul>
<p>An example to send an MOB alarm from an N2K source, the gateway would convert and send something like:</p>
<pre><code>{
  &quot;context&quot;: &quot;vessels.urn:mrn:signalk:uuid:c0d79334-4e25-4245-8892-54e8ccc8021d&quot;,
  &quot;updates&quot;: [
    {
      &quot;source&quot;: {...},
      &quot;timestamp&quot;: &quot;2017-08-15T16:00:05.200Z&quot;,
      &quot;values&quot;: [
        {
          &quot;path&quot;: &quot;notifications.mob&quot;,
          &quot;value&quot;: {
            &quot;message&quot;: &quot;MOB&quot;,
            &quot;state&quot;: &quot;emergency&quot;,
            &quot;method&quot;: [&quot;visual&quot;, &quot;sound&quot;]
          }
        }
      ]
    }
  ]
}
</code></pre>
<p>The resulting full signalk tree would be:</p>
<pre><code>{
  &quot;vessels&quot;: {
    &quot;urn:mrn:signalk:uuid:c0d79334-4e25-4245-8892-54e8ccc8021d&quot;: {
      &quot;uuid&quot;: &quot;...&quot;,
      &quot;notifications&quot;: {
        &quot;mob&quot;: {
          &quot;value&quot;: {
            &quot;method&quot;: [&quot;visual&quot;, &quot;sound&quot;],
            &quot;state&quot;: &quot;emergency&quot;,
            &quot;message&quot;: &quot;Man Overboard!&quot;
          },
          &quot;timestamp&quot;: &quot;2017-04-10T08:33:53Z&quot;,
          &quot;$source&quot;: &quot;...&quot;
        }
      }
    }
  },
  ...
}
</code></pre>
<p>To clear the alarm condition, send:</p>
<pre><code>{
  &quot;context&quot;: &quot;vessels.urn:mrn:signalk:uuid:c0d79334-4e25-4245-8892-54e8ccc8021d&quot;,
  &quot;updates&quot;: [
    {
      &quot;source&quot;: {...},
      &quot;timestamp&quot;: &quot;2017-08-15T16:00:05.538Z&quot;,
      &quot;values&quot;: [
        {
          &quot;path&quot;: &quot;notifications.mob&quot;,
          &quot;value&quot;: null
        }
      ]
    }
  ]
}
</code></pre>
<h2 id="multiple-cases-of-the-same-alarm"><a class="header" href="#multiple-cases-of-the-same-alarm">Multiple cases of the same alarm</a></h2>
<p>Should multiple cases of the same alarm occur (eg a gps loses signal, then a second gps loses signal) the alarms are
handled the same as any other multiple values in signalk. However alarms will tend to be re-issued whenever the
underlying data changes.</p>
<p>The servers alarm monitoring processes are expected to be smart enough to know that the anchor alarm is triggered, and
its not necessary to raise a second copy of the same alarm, after all there is only one boat dragging!</p>
<p>This may be handled differently for notifications. It may be useful to know that your gps's are all failing
intermittently, or that . Hence the handling of multiple copies of alarms is an implementation issue, and may vary.</p>
<h2 id="the-key-should-be-unique"><a class="header" href="#the-key-should-be-unique">The key should be unique</a></h2>
<p>If we have an alarm <code>vessels.self.notifications.navigation.anchor.currentRadius</code> and we attempt to write another higher
in the same tree at <code>vessels.self.notifications</code> it must not replace or remove the existing alarm. Since the
<code>meta.zones</code> structure is only valid on signalk leaf values this occurs naturally in most circumstances. But it is
possible to set an alarm value arbitrarily (eg MOB) and care should be taken in implementations that keys do not
overwrite existing paths.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="connection.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="security.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="connection.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="security.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
