<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Subscription Protocol</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Signal K Specification</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Getting Started</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="start_using.html"><strong aria-hidden="true">2.1.</strong> Using SK</a></li><li class="chapter-item expanded "><a href="start_developing.html"><strong aria-hidden="true">2.2.</strong> Developing with SK</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Data Model</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="data_model.html"><strong aria-hidden="true">3.1.</strong> Full and Delta Models</a></li><li class="chapter-item expanded "><a href="data_model_multiple_values.html"><strong aria-hidden="true">3.2.</strong> Multiple Values</a></li><li class="chapter-item expanded "><a href="data_model_metadata.html"><strong aria-hidden="true">3.3.</strong> Metadata</a></li><li class="chapter-item expanded "><a href="sources.html"><strong aria-hidden="true">3.4.</strong> Sources</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> API</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="urls_ports.html"><strong aria-hidden="true">4.1.</strong> URLs and Ports</a></li><li class="chapter-item expanded "><a href="rest_api.html"><strong aria-hidden="true">4.2.</strong> REST API</a></li><li class="chapter-item expanded "><a href="streaming_api.html"><strong aria-hidden="true">4.3.</strong> Streaming API</a></li><li class="chapter-item expanded "><a href="subscription_protocol.html" class="active"><strong aria-hidden="true">4.4.</strong> Subscription Protocol</a></li><li class="chapter-item expanded "><a href="connection.html"><strong aria-hidden="true">4.5.</strong> Discovery &amp; Connection Establishment</a></li><li class="chapter-item expanded "><a href="notifications.html"><strong aria-hidden="true">4.6.</strong> Notifications</a></li><li class="chapter-item expanded "><a href="security.html"><strong aria-hidden="true">4.7.</strong> Security</a></li><li class="chapter-item expanded "><a href="request_response.html"><strong aria-hidden="true">4.8.</strong> Request/Response</a></li><li class="chapter-item expanded "><a href="put.html"><strong aria-hidden="true">4.9.</strong> PUT Requests</a></li></ol></li><li class="chapter-item expanded "><a href="how_to_help.html"><strong aria-hidden="true">5.</strong> How Can I Help?</a></li><li class="chapter-item expanded "><a href="vesselsBranch.html"><strong aria-hidden="true">6.</strong> Appendix A: Keys Reference (Vessel)</a></li><li class="chapter-item expanded "><a href="otherBranches.html"><strong aria-hidden="true">7.</strong> Appendix B: Keys Reference (Others)</a></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">8.</strong> Appendix C: Changelog</a></li><li class="chapter-item expanded "><a href="versioning.html"><strong aria-hidden="true">9.</strong> Appendix D: Versioning</a></li><li class="chapter-item expanded "><a href="access_requests.html"><strong aria-hidden="true">10.</strong> Appendix E: Access Requests</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="subscription-protocol"><a class="header" href="#subscription-protocol">Subscription Protocol</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>By default a Signal K server will provide a new WebSocket client with a delta stream of the <code>vessels.self</code> record, as
updates are received from sources. E.g. <code>/signalk/v1/stream</code> will provide the following delta stream, every time the
log value changes.</p>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;vessels.urn:mrn:imo:mmsi:234567890&quot;,
  &quot;updates&quot;: [
    {
      &quot;source&quot;: {
        &quot;label&quot;: &quot;N2000-01&quot;,
        &quot;type&quot;: &quot;NMEA2000&quot;,
        &quot;src&quot;: &quot;115&quot;,
        &quot;pgn&quot;: 128275
      },
      &quot;values&quot;: [
        {
          &quot;path&quot;: &quot;navigation.trip.log&quot;,
          &quot;value&quot;: 43374
        },
        {
          &quot;path&quot;: &quot;navigation.log&quot;,
          &quot;value&quot;: 17404540
        }
      ]
    }
  ]
}
</code></pre>
<blockquote>
<p>Below we refer to WebSockets, but the same process works in the same way over any transport. E.g. for a raw TCP
connection the connection causes the above message to be sent, and sending the subscribe messages will have the same
effect as described here.</p>
</blockquote>
<p>This can be a lot of messages, many you may not need, especially if your boat has many sensors, or other data sources.
Often you will want to subscribe to a much smaller range of data. Especially for single value displays, it does not
make sense to get the entire data stream when only a single value is wanted.</p>
<p>First you will want to unsubscribe from the current default (or you may have already connected with
<code>ws://hostname/signalk/v1/stream?subscribe=none</code>). To unsubscribe all create an <code>unsubscribe</code> message with wildcards
and send the message over the WebSocket connection:</p>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;*&quot;,
  &quot;unsubscribe&quot;: [
    {&quot;path&quot;: &quot;*&quot;}
  ]
}
</code></pre>
<p>To subscribe to the required criteria send a suitable subscribe message:</p>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;vessels.self&quot;,
  &quot;subscribe&quot;: [
    {
      &quot;path&quot;: &quot;navigation.speedThroughWater&quot;,
      &quot;period&quot;: 1000,
      &quot;format&quot;: &quot;delta&quot;,
      &quot;policy&quot;: &quot;ideal&quot;,
      &quot;minPeriod&quot;: 200
    },
    {
      &quot;path&quot;: &quot;navigation.logTrip&quot;,
      &quot;period&quot;: 10000
    }
  ]
}
</code></pre>
<ul>
<li><code>path=[path.to.key]</code> is appended to the context to specify subsets of the context.
The path value can use the wildcard <code>*</code>. A wildcard in the middle of a path (<code>propulsion/*/oilTemperature</code>) allows any
value for that part and a wildcard at the end (<code>propulsion/port/*</code>) matches all paths beginning with the specified
prefix.</li>
</ul>
<p>The following are optional, included above only for example as it uses defaults anyway:</p>
<ul>
<li><code>period=[millisecs]</code> becomes the transmission rate, e.g. every <code>period/1000</code> seconds. Default: 1000</li>
<li><code>format=[delta|full]</code> specifies delta or full format. Default: delta</li>
<li><code>policy=[instant|ideal|fixed]</code>. Default: ideal. (does not apply to meta - see below)</li>
<li><code>instant</code> means send all changes as fast as they are received, but no faster than <code>minPeriod</code>. With this policy the
client has an immediate copy of the current state of the server.</li>
<li><code>ideal</code> means use <code>instant</code> policy, but if no changes are received before <code>period</code>, then resend the last known
values.</li>
<li><code>fixed</code> means simply send the last known values every <code>period</code>.</li>
<li><code>minPeriod=[millisecs]</code> becomes the fastest message transmission rate allowed, e.g. every <code>minPeriod/1000</code> seconds.
This is only relevant for policy='instant' to avoid swamping the client or network.</li>
</ul>
<p>You can subscribe to multiple data keys multiple times, from multiple apps or devices. Each app or device simply
subscribes to the data it requires, and the server and/or client implementation may combine subscriptions to avoid
duplication as it prefers on a per connection basis. At the same time it is good practice to open the minimum
connections necessary, for instance one WebSocket connection shared between an instrument panel with many gauges,
rather then one WebSocket connection per gauge.</p>
<h2 id="meta-data"><a class="header" href="#meta-data">Meta data</a></h2>
<p>Meta is updated via the <code>meta</code> section within the delta message. As meta changes infrequently it is only sent when it has changed.</p>
<p>Servers implementing the subscription model (ie. using deltas) SHOULD implement meta deltas. Where meta deltas are implemented, servers MUST only ever send full copies of the meta for a leaf, ie. they MUST NEVER send a partial meta.</p>
<p>Upon receiving a new subscription a server MUST send the meta for each leaf subscribed to; this MAY be in the same JSON document as the values, or in a separate one prior to sending values for that leaf or leaves. Subsequently the server MUST resend the full meta for a leaf each time any item in that meta is changed. This is equivalent to the <code>instant</code> subscription for values. Therefore meta is never subscribed on an <code>ideal</code> or <code>fixed</code> policy, irrespective of the policy requested by the consumer (which applies to values only).</p>
<h2 id="multiple-value-handling-in-subscriptions"><a class="header" href="#multiple-value-handling-in-subscriptions">Multiple value handling in subscriptions</a></h2>
<p>A subscription to a key is for all the updates to that key. If there are multiple sources generating data for that key
the client will get all their updates.</p>
<p>If a client wants only the values of a single source it should subscribe to a path that includes the full path under
<code>values</code> including the source reference key of the source. The source reference should be enclosed in square brackets:
<code>navigation.speedThroughWater.values[n2kFromFile.43]</code>. The client can retrieve the relevant data via REST API. See
<a href="data_model_multiple_values.html">Multiple Values</a> for more information.</p>
<h2 id="single-use-or-intermittent-data"><a class="header" href="#single-use-or-intermittent-data">Single use, or intermittent data</a></h2>
<p>When data is required once only, or upon request the <code>subscribe/unsubscribe</code> method should not be used. If the client
is http capable the REST API is a good choice, or use <code>get/list/put</code> messages over WebSockets or TCP.</p>
<h2 id="use-cases-and-proposed-solutions"><a class="header" href="#use-cases-and-proposed-solutions">Use Cases and Proposed Solutions</a></h2>
<h3 id="local-boat-individual-instruments"><a class="header" href="#local-boat-individual-instruments">Local boat individual instruments</a></h3>
<p>A gauge-type display for just one or a few data items for the 'self' vessel should be able to specify that it only
wants those items for the self vessel.</p>
<p>This can be achieved by a default WebSocket connection <code>/signalk/v1/stream?subcribe=none</code>, then sending a JSON message:</p>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;vessels.self&quot;,
  &quot;subscribe&quot;: [
    {
      &quot;path&quot;: &quot;environment.depth.belowTransducer&quot;
    },
    {&quot;path&quot;: &quot;navigation.speedThroughWater&quot;}
  ]
}
</code></pre>
<p>The JSON format is also viable over a simple TCP or serial transport, and is therefore supported as the primary
subscription method.</p>
<h3 id="map-display-with-all-known-vessel-positions--directions-served-over-3g-cellular-connection"><a class="header" href="#map-display-with-all-known-vessel-positions--directions-served-over-3g-cellular-connection">Map display with all known vessel positions &amp; directions, served over 3G cellular connection</a></h3>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;vessels.*&quot;,
  &quot;subscribe&quot;: [
    {
      &quot;path&quot;: &quot;navigation.position&quot;,
      &quot;period&quot;: 120000,
      &quot;policy&quot;: &quot;fixed&quot;
    },
    {
      &quot;path&quot;: &quot;navigation.courseOverGround&quot;,
      &quot;period&quot;: 120000,
      &quot;policy&quot;: &quot;fixed&quot;
    }
  ]
}
</code></pre>
<p>The result is a delta message of the Signal K data with just <code>position</code> and <code>courseOverGround</code> branches for all known
vessels, sent every 2 minutes (120 seconds) even if no data has been updated.</p>
<h3 id="position-of-a-certain-vessel-immediately-it-changes-but-once-per-minute-at-most"><a class="header" href="#position-of-a-certain-vessel-immediately-it-changes-but-once-per-minute-at-most">Position of a certain vessel, immediately it changes, but once per minute at most</a></h3>
<pre><code class="language-json">{
  &quot;context&quot;: &quot;vessels.230029970&quot;,
  &quot;subscribe&quot;: [
    {
      &quot;path&quot;: &quot;navigation.position&quot;,
      &quot;minPeriod&quot;: 60000,
      &quot;policy&quot;: &quot;instant&quot;
    }
  ]
}
</code></pre>
<p>The result will be delta position messages for vessel 230029970, broadcast whenever it changes, but with minimum
interval of 60 seconds. Messages are delayed to meet the minimum interval with newer messages overriding the previous
message in the buffer.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="streaming_api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="connection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="streaming_api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="connection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
